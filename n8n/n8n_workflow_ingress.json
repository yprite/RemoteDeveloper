{
    "nodes": [
        {
            "parameters": {
                "method": "POST",
                "url": "http://127.0.0.1:8001/agent/plan",
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "task",
                            "value": "={{ $json.message.text }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                528,
                336
            ],
            "id": "fa829262-88ad-420a-8f41-2bdf58f226a5",
            "name": "[PLAN] Call Agent"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "http://127.0.0.1:8001/agent/implementation",
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "task",
                            "value": "={{ $node['[PLAN] Call Agent'].json.output }}"
                        },
                        {
                            "name": "context",
                            "value": "={{ $json }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                752,
                336
            ],
            "id": "9e21a51e-75fc-4067-9446-33f04073c927",
            "name": "[IMPL] Call Agent"
        },
        {
            "parameters": {
                "method": "POST",
                "url": "http://127.0.0.1:8001/agent/test",
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "task",
                            "value": "={{ $node['[IMPL] Call Agent'].json.output }}"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                976,
                336
            ],
            "id": "9a5a1da5-80c2-4e88-a1b5-d8045699c52a",
            "name": "[TEST] Call Agent"
        },
        {
            "parameters": {
                "updates": [
                    "message"
                ],
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegramTrigger",
            "typeVersion": 1,
            "position": [
                -320,
                -352
            ],
            "id": "0c930383-428c-4504-8272-56b5cc67938a",
            "name": "Telegram Trigger1",
            "webhookId": "38151ab9-2535-4c07-bc2e-367336ce9be1",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "resource": "chat",
                "model": "gpt-4",
                "prompt": {
                    "messages": [
                        {
                            "role": "assistant",
                            "content": "=={{ 'Refine the following user request into a detailed, clear technical task description for a coding agent. Provide only the refined task description, no intro/outro.\\\\n\\\\nUser Request: ' + $json.message.text }}"
                        },
                        {
                            "role": "system",
                            "content": "You are an expert Technical Architect. Your job is to analyze the user's request and refine it into a polished, detailed technical task description that a 'Plan Agent' can understand. \\n\\nFocus on:\\n1. Clear Objective\\n2. Key Functional Requirements\\n3. Technical Constraints (Python, Redis, n8n, FastAPI environment)\\n\\nOutput ONLY the refined technical task description, no conversational filler."
                        }
                    ]
                },
                "options": {},
                "requestOptions": {}
            },
            "type": "n8n-nodes-base.openAi",
            "typeVersion": 1,
            "position": [
                -112,
                -352
            ],
            "id": "d6e85153-7332-4082-b426-63394a12daf9",
            "name": "Refine Requirements1",
            "credentials": {
                "openAiApi": {
                    "id": "GA8wumsocQmRQ3MU",
                    "name": "OpenAi account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{ $node['Telegram Trigger1'].json.message.chat.id }}",
                "text": "={{ '‚úÖ Task Registered!\\n\\nÔøΩ Original: ' + $node['Telegram Trigger1'].json.message.text + '\\n\\nü§ñ Refined: ' + $node['Refine Requirements1'].json.content + '\\n\\n(Event ID: ' + $json.event_id + ')' }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                272,
                -352
            ],
            "id": "abb4aa77-0b4b-4b2c-ac8a-ea27af210293",
            "name": "Reply to User1",
            "webhookId": "3d3c67e1-09e6-447a-acb5-0c2aefaea3da",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "path": "webhook-plan-report",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -320,
                -160
            ],
            "id": "2ac285f3-4e69-41d0-89f5-bfb5de562093",
            "name": "PLAN-REPORT-WEBHOOK1",
            "webhookId": "webhook-plan-report"
        },
        {
            "parameters": {
                "chatId": "={{ $json.body.context.chat_id }}",
                "text": "={{ 'üìù PLAN Completed:\\n' + $json.body.output }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                -96,
                -160
            ],
            "id": "4ecfe7fa-ae6b-4321-9a52-1a12241908ea",
            "name": "[PLAN] Report1",
            "webhookId": "3d3c67e1-09e6-447a-acb5-0c2aefaea3da",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "path": "webhook-impl-report",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -320,
                32
            ],
            "id": "6c32009c-2bfd-4ef6-8376-63cb181e18f9",
            "name": "IMPLEMENT-REPORT-WEBHOOK1",
            "webhookId": "webhook-impl-report"
        },
        {
            "parameters": {
                "chatId": "={{ $json.body.context.chat_id }}",
                "text": "={{ 'üíª IMPLEMENTATION Completed:\\n' + $json.body.output }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                -96,
                32
            ],
            "id": "b65e4824-dd9f-4e3a-9130-1401cbce883a",
            "name": "[IMPL] Report1",
            "webhookId": "10646e7e-a98a-4e0a-86df-ac210397a83b",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "path": "webhook-test-report",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
                -320,
                240
            ],
            "id": "3cf86f71-54a9-4e01-b5df-f367962fb849",
            "name": "TEST-REPORT-WEBHOOK1",
            "webhookId": "webhook-test-report"
        },
        {
            "parameters": {
                "chatId": "={{ $json.body.context.chat_id }}",
                "text": "={{ '‚úÖ TEST Completed:\\n' + $json.body.output }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                -96,
                240
            ],
            "id": "8859d29e-6a80-42f3-bea6-4d5b1f929a68",
            "name": "[TEST] Report1",
            "webhookId": "836ec327-20d3-4fad-9614-3e6462acc5ec",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "={{ $node[\"Telegram Trigger\"]?.json?.message?.text || $node[\"Edit Fields\"]?.json?.message?.text || \"Default Test Message\" }}",
                "options": {
                    "systemMessage": "You are a helpful assistant"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
                -128,
                -848
            ],
            "id": "7518b6fd-96fc-4388-b9d8-b686ba209f6b",
            "name": "AI Agent",
            "disabled": true
        },
        {
            "parameters": {
                "model": {
                    "__rl": true,
                    "value": "gpt-4o",
                    "mode": "list",
                    "cachedResultName": "gpt-4o"
                },
                "builtInTools": {},
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
                -320,
                -736
            ],
            "id": "e815c26b-3580-4013-9134-779c29681743",
            "name": "OpenAI Chat Model",
            "credentials": {
                "openAiApi": {
                    "id": "GA8wumsocQmRQ3MU",
                    "name": "OpenAi account"
                }
            },
            "disabled": true
        },
        {
            "parameters": {
                "chatId": "={{ $node[\"Telegram Trigger\"]?.json?.message?.chat?.id || 123456789 }}",
                "text": "={{ $json.output }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1.2,
            "position": [
                496,
                -832
            ],
            "id": "93df68a3-21da-41e0-acdd-48baf779508c",
            "name": "Send a text message",
            "webhookId": "6a903107-3436-492e-a353-d87d4e521c56",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            },
            "disabled": true
        },
        {
            "parameters": {
                "toolDescription": "Lists files in a directory. Default path is '.'",
                "url": "http://localhost:8001/files/list",
                "sendQuery": true,
                "queryParameters": {
                    "parameters": [
                        {}
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.3,
            "position": [
                -32,
                -1024
            ],
            "id": "0f9ca2dc-eda8-438b-bd23-d95d0f53801e",
            "name": "list_files",
            "disabled": true
        },
        {
            "parameters": {
                "toolDescription": "Reads a file. Args: path",
                "method": "POST",
                "url": "http://localhost:8001/files/read",
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "path"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.3,
            "position": [
                128,
                -1024
            ],
            "id": "3fe75548-f7b2-4f71-9901-9cf39501ba90",
            "name": "read_file",
            "disabled": true
        },
        {
            "parameters": {},
            "type": "n8n-nodes-base.errorTrigger",
            "typeVersion": 1,
            "position": [
                -320,
                -512
            ],
            "id": "c34214e4-ae9d-4338-9683-958cc6b91e7e",
            "name": "Error Trigger"
        },
        {
            "parameters": {
                "chatId": "{{ $node['Telegram Trigger1'].json.message.chat.id }}",
                "text": "=={{ [\n  '‚ùå n8n Workflow Error',\n  '',\n  'üìõ Workflow: ' + $json.workflow.name,\n  'üß± Node: '    + ($json.error.node?.name || 'Unknown node'),\n  'üïí Time: '    + ($json.error.time || $json.execution.startedAt || $now),\n  'üÜî Execution: ' + $json.execution.id,\n  '',\n  'üí• Message: ' + $json.error.message,\n].join('\\n') }}",
                "additionalFields": {}
            },
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                -112,
                -512
            ],
            "id": "3b71bb4e-ed80-4a29-93b6-40fb788b35d2",
            "name": "Send Error to Telegram",
            "webhookId": "b36f5cf5-ff71-4af8-a8af-e2efb5960744",
            "credentials": {
                "telegramApi": {
                    "id": "S0vdRjmf9wwtVJhb",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "http://127.0.0.1:8001/event/ingest",
                "sendBody": true,
                "contentType": "=json",
                "specifyBody": "json",
                "bodyParameters": {
                    "parameters": [
                        {}
                    ]
                },
                "jsonBody": "={\n  \"task\": \"{{ $node['Refine Requirements'].json.content.replace(/\"/g, '\\\\\"') }}\",\n  \"context\": {\n    \"chat_id\": {{ $node['Telegram Trigger'].json.message.chat.id }},\n    \"user_id\": {{ $node['Telegram Trigger'].json.message.from.id }},\n    \"platform\": \"telegram\",\n    \"original_request\": \"{{ $node['Telegram Trigger'].json.message.text.replace(/\"/g, '\\\\\"') }}\"\n  }\n}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                80,
                -352
            ],
            "id": "477f5b48-48bb-40de-8c70-e22a4207b0b6",
            "name": "PO-CREATE-EVENT"
        }
    ],
    "connections": {
        "[PLAN] Call Agent": {
            "main": [
                []
            ]
        },
        "[IMPL] Call Agent": {
            "main": [
                []
            ]
        },
        "[TEST] Call Agent": {
            "main": [
                []
            ]
        },
        "Telegram Trigger1": {
            "main": [
                [
                    {
                        "node": "Refine Requirements1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Refine Requirements1": {
            "main": [
                [
                    {
                        "node": "PO-CREATE-EVENT",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "PLAN-REPORT-WEBHOOK1": {
            "main": [
                [
                    {
                        "node": "[PLAN] Report1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IMPLEMENT-REPORT-WEBHOOK1": {
            "main": [
                [
                    {
                        "node": "[IMPL] Report1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "TEST-REPORT-WEBHOOK1": {
            "main": [
                [
                    {
                        "node": "[TEST] Report1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "AI Agent": {
            "main": [
                [
                    {
                        "node": "Send a text message",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "OpenAI Chat Model": {
            "ai_languageModel": [
                [
                    {
                        "node": "AI Agent",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "list_files": {
            "ai_tool": [
                [
                    {
                        "node": "AI Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "read_file": {
            "ai_tool": [
                [
                    {
                        "node": "AI Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Error Trigger": {
            "main": [
                [
                    {
                        "node": "Send Error to Telegram",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "PO-CREATE-EVENT": {
            "main": [
                [
                    {
                        "node": "Reply to User1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "pinData": {},
    "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "0f86d64d2cd76a91e979ae881487653381dd65c118e5834031f33f26af6c01b1"
    }
}